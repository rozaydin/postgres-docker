# ===========================================================
# PostgreSQL 18 â€” 2 cores / 8 GB RAM baseline
# ===========================================================

# --- Memory & parallelism ---
shared_buffers = 2GB
effective_cache_size = 6GB
work_mem = 32MB                 # watch temp files; raise/lower per workload
maintenance_work_mem = 768MB
max_connections = 80
max_worker_processes = 4
max_parallel_workers = 2
max_parallel_workers_per_gather = 1
max_parallel_maintenance_workers = 1

# --- WAL & checkpoints ---
wal_level = replica
max_wal_size = 4GB
min_wal_size = 1GB
checkpoint_timeout = 15min
checkpoint_completion_target = 0.9
wal_compression = on

# --- Autovacuum / maintenance ---
autovacuum = on
autovacuum_naptime = 15s
autovacuum_vacuum_cost_limit = 3000
autovacuum_analyze_scale_factor = 0.05
autovacuum_vacuum_scale_factor  = 0.10

# --- I/O tuning (adjust for your storage) ---
random_page_cost = 1.2
effective_io_concurrency = 200     # lower (e.g., 32) for HDD/NFS
max_files_per_process = 3000

# --- Preload & instrumentation ---
shared_preload_libraries = 'pg_stat_statements,pg_cron'
pg_stat_statements.max = 5000
pg_stat_statements.track = all
track_io_timing = on
cron.database_name = 'postgres'

# --- Planner / execution ---
default_statistics_target = 500
jit = off

# --- Logging ---
logging_collector = on
log_directory = 'log'
log_filename = 'postgresql-%a.log'
log_truncate_on_rotation = on
log_rotation_age = 1d
log_min_duration_statement = 250ms
log_checkpoints = on
log_autovacuum_min_duration = 0
log_temp_files = 0

# --- Locale & misc ---
client_encoding = 'UTF8'
lc_messages = 'C'
lc_monetary = 'C'
lc_numeric = 'C'
lc_time = 'C'
timezone = 'UTC'

# --- Safety (keep defaults unless you know better) ---
# fsync = on
# synchronous_commit = on
# full_page_writes = on